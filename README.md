# Техническое задание (ТЗ) на разработку Telegram-бота для проверки IMEI

## 1. Общее описание
Необходимо разработать бэкенд-систему для проверки IMEI устройств, которая будет интегрирована с Telegram-ботом и предоставлять API для внешних запросов. В рамках тестового задания реализуется базовая работа с одним сервисом IMEI-проверки.

## 2. Функционал

### 2.1 Доступ
**Белый список пользователей для Telegram:**
- Реализовать белый список для доступа к функционалу бота.
- Только пользователи из списка смогут отправлять запросы.

**Авторизация через API:**
- Реализовать авторизацию по токену для доступа к API.
- Запросы к API должны проверять корректность токена.

### 2.2 Telegram-бот
- Пользователь отправляет боту IMEI.
- Бот выполняет следующие действия:
  1. Проверяет IMEI на валидность (длина 15 цифр, соответствие алгоритму Luhn).
  2. Отправляет запрос к сервису IMEI-проверки.
  3. Возвращает пользователю информацию о проверенном IMEI.
  
### 2.3 Запросы API
#### Запрос на получение информации:
- **Метод:** `POST /api/check-imei`
- **Параметры запроса:**
  - `imei` (строка, обязательный) — IMEI устройства.
  - `token` (строка, обязательный) — токен авторизации.
- **Ответ:**
  - JSON с информацией о IMEI.

## 3. Интеграция с сервисами
Для тестирования используется сервис IMEI-проверки:
- **API URL:** https://imeicheck.net/
- **Токен API Sandbox:** `e4oEaZY1Kom5OXzybETkMlwjOCy3i8GSCGTHzWrhd4dc563b`
- **Документация:** [imeicheck.net API](https://imeicheck.net/promo-api)

## 4. Технические требования
- Язык программирования: Python
- Фреймворк: FastAPI
- База данных: SQLite3 (для хранения белого списка пользователей и логов запросов)
- Библиотека для работы с Telegram API: aiogram
- Хранение токенов и ключей API в `.env` файле
- Логирование запросов и ошибок

## 5. Реализация
### 5.1 Структура проекта
```
/imeibot
│── /app
│   ├── main.py          # Основной файл приложения
│   ├── config.py        # Конфигурации и переменные окружения
│   ├── database.py      # Инициализация базы данных
│   ├── models.py        # Модели базы данных
│   ├── api.py           # Реализация API
│   ├── bot.py           # Логика работы Telegram-бота
│   ├── imei_checker.py  # Взаимодействие с сервисом IMEI
│   ├── utils.py         # Вспомогательные функции
│── .env                 # Файл окружения с секретами
│── requirements.txt     # Зависимости проекта
│── README.md            # Документация проекта
```

### 5.2 Реализация API (FastAPI)
- Определить эндпоинт `/api/check-imei`, принимающий POST-запросы.
- Реализовать проверку авторизационного токена.
- Валидировать IMEI перед отправкой к внешнему API.
- Обрабатывать и форматировать ответ от внешнего сервиса.

### 5.3 Реализация Telegram-бота (Aiogram)
- Создать команду `/start` для приветствия пользователя.
- Реализовать обработчик сообщений с IMEI, проверяющий валидность.
- Отправлять запрос к API `/api/check-imei` и возвращать ответ пользователю.
- Добавить обработку ошибок и логирование.

### 5.4 Настройка базы данных (SQLite3)
- Таблица `users` для хранения списка пользователей с доступом.
- Таблица `logs` для хранения истории запросов.

### 5.5 Логирование и обработка ошибок
- Логировать успешные и неуспешные запросы.
- Обрабатывать возможные ошибки, включая неверные IMEI и недоступность сервиса.

## 6. Дополнительные требования
- Код должен быть структурированным и читаемым.
- Покрытие кода базовыми тестами.
- Использование асинхронного подхода для обработки запросов.

